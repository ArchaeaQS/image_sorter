# 実装メモ

## 概要
機械学習データセット作成用の画像仕分けアプリケーション

## 技術スタック
- **フロントエンド**: React + TypeScript + Electron
- **バックエンド**: FastAPI + Python
- **パッケージ管理**: uv (Python), npm (Node.js)

## アーキテクチャ

### フロントエンド構成
```
src/
├── main/           # Electronメインプロセス
│   └── main.ts
├── renderer/       # Reactレンダラープロセス
│   ├── components/
│   │   ├── App.tsx
│   │   ├── Controls.tsx
│   │   ├── ImageGrid.tsx
│   │   ├── ProgressBar.tsx
│   │   └── SettingsModal.tsx
│   ├── index.tsx
│   └── styles.css
└── types.ts       # 共通型定義
```

### バックエンドAPI
```
POST /get-images    # 画像ファイル一覧取得
POST /classify      # 画像分類・移動処理
GET /               # ヘルスチェック
```

## 重要な実装ポイント

### 1. 状態管理
- React hooksベースの状態管理
- `AppState`で全体状態を管理
- 画像の分類状態は`imageStates`オブジェクトで管理

### 2. 画像表示・操作
- グリッド表示（デフォルト10×10）
- 左クリック：次の分類状態へ
- 右クリック：前の分類状態へ
- バッチ処理（100枚単位）

### 3. API通信
- fetch APIを使用してHTTP通信
- エラーハンドリングとローディング状態管理
- IPCRendererではなく直接HTTP通信

### 4. ファイル操作
- フォルダ選択：Electron dialog
- 画像移動：バックエンドのshutil.moveで実行
- サポート形式：JPG, JPEG, PNG

## 設定管理

### グリッド設定
- 列数・行数の動的変更
- バッチサイズ = 列数 × 行数

### クラス設定
- 動的なクラス追加・削除
- 色分け表示
- 並び替え機能

## UI/UX設計

### デザインシステム
- CSS変数による一貫したスタイリング
- グラデーション・アニメーション
- モダンなカードベースUI

### レスポンシブ対応
- モバイル・タブレット対応
- 柔軟なグリッドレイアウト

## パフォーマンス考慮

### 最適化ポイント
- 画像の遅延読み込み
- バッチ処理によるメモリ効率化
- webpack最適化設定

### スケーラビリティ
- 大量画像の処理対応
- 非同期処理の活用

## セキュリティ

### 基本方針
- ファイルパスの検証
- 権限エラーハンドリング
- XSS対策（React標準対応）

## 今後の拡張予定

### 機能追加
- [ ] 元に戻す機能
- [ ] 設定の永続化
- [ ] 文字エンコーディング対応
- [ ] 一括処理機能
- [ ] ショートカットキー対応

### 技術改善
- [ ] テスト導入
- [ ] CI/CD設定
- [ ] ログ機能
- [ ] エラー監視

## 開発環境

### 必須要件
- Node.js 18+
- Python 3.11+
- uv パッケージマネージャ

### 開発コマンド
```bash
# フロントエンド
npm run dev         # 開発サーバー
npm run build       # ビルド
npm run start       # アプリ起動

# バックエンド
cd backend
uv run uvicorn main:app --reload
```

## トラブルシューティング

### よくある問題
1. **GPUエラー**: 表示の問題だが機能に影響なし
2. **ポート競合**: バックエンドサーバーの重複起動
3. **文字化け**: 日本語パス対応が必要
4. **権限エラー**: フォルダアクセス権限の確認

### デバッグ方法
- Electron DevToolsを活用
- バックエンドログの確認
- ネットワークタブでAPI通信確認